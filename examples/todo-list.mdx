---
title: "Todo List Agent"
description: "A complete example showing how to instrument an agent with Playgent"
---

## Overview

This example shows a complete todo-list agent instrumented with Playgent. The key Playgent integration points are highlighted below.

## Step 1: Setup and Wrap the Client

First, import and wrap your OpenAI client with Playgent:

```python
import playgent
from openai import OpenAI

# Wrap OpenAI client with Playgent to automatically track all LLM calls
client = playgent.wrap_openai(OpenAI(), api_key="<PLAYGENT-API-KEY>")
```

## Step 2: Implement Your Tools

Define your tool functions. Use `@playgent.record` to trace individual tool executions:

```python
from typing import List

todo_list: List[str] = []

@playgent.record  # Track this tool function
def add_to_todo_list(task: str) -> str:
    todo_list.append(task)
    return f"Added '{task}' to todo list"

@playgent.record  # Track this tool function
def get_todo_list() -> List[str]:
    return todo_list

@playgent.record  # Track this tool function
def get_todo_list_size() -> int:
    return len(todo_list)
```

## Step 3: Define Tool Schemas

```python
tools = [
    {
        "type": "function",
        "name": "add_to_todo_list",
        "description": "Add a task to the todo list.",
        "parameters": {
            "type": "object",
            "properties": {
                "task": {
                    "type": "string",
                    "description": "The task to add to the todo list",
                },
            },
            "required": ["task"],
        },
    },
    {
        "type": "function",
        "name": "get_todo_list",
        "description": "Get the current todo list.",
        "parameters": {"type": "object", "properties": {}},
    },
    {
        "type": "function",
        "name": "get_todo_list_size",
        "description": "Get the number of items currently in the todo list.",
        "parameters": {"type": "object", "properties": {}},
    },
]
```

## Step 4: Create Your Agent Function

Use `@playgent.record` on your main agent function to create a trace:

```python
import json

@playgent.record  # This creates a trace for the entire agent execution
def infer(input_text: str, model: str = "gpt-4", tools_list: List = None):
    """Main agent function that processes user input and manages tools."""
    if tools_list is None:
        tools_list = tools

    messages = [{"role": "user", "content": input_text}]

    while True:
        response = client.chat.completions.create(
            model=model,
            messages=messages,
            tools=tools_list
        )

        # Handle tool calls
        if response.choices[0].message.tool_calls:
            messages.append(response.choices[0].message)

            for tool_call in response.choices[0].message.tool_calls:
                name = tool_call.function.name
                args = json.loads(tool_call.function.arguments)

                # Execute the appropriate tool
                if name == "add_to_todo_list":
                    result = add_to_todo_list(**args)
                elif name == "get_todo_list":
                    result = get_todo_list()
                elif name == "get_todo_list_size":
                    result = get_todo_list_size()
                else:
                    result = f"Unknown tool: {name}"

                messages.append({
                    "role": "tool",
                    "tool_call_id": tool_call.id,
                    "content": json.dumps({"result": result})
                })
        else:
            # No more tool calls, return final response
            break

    return {
        "final_output": response.choices[0].message.content,
        "todo_list": todo_list
    }
```

## Step 5: Run Your Agent

```python
if __name__ == "__main__":
    # Run the agent - Playgent automatically records this as a trace
    result = infer("Add 'buy milk' and 'walk the dog' to my todo list")
    print(result)
```

## Complete Code

<Accordion title="View complete implementation">

```python
import json
from typing import List
import playgent
from openai import OpenAI

# ============================================
# PLAYGENT SETUP
# ============================================
# Wrap OpenAI client with Playgent
client = playgent.wrap_openai(OpenAI(), api_key="<PLAYGENT-API-KEY>")

# ============================================
# TOOL IMPLEMENTATIONS
# ============================================
todo_list: List[str] = []

@playgent.record  # Track this tool function
def add_to_todo_list(task: str) -> str:
    todo_list.append(task)
    return f"Added '{task}' to todo list"

@playgent.record  # Track this tool function
def get_todo_list() -> List[str]:
    return todo_list

@playgent.record  # Track this tool function
def get_todo_list_size() -> int:
    return len(todo_list)

# ============================================
# TOOL SCHEMAS
# ============================================
tools = [
    {
        "type": "function",
        "name": "add_to_todo_list",
        "description": "Add a task to the todo list.",
        "parameters": {
            "type": "object",
            "properties": {
                "task": {
                    "type": "string",
                    "description": "The task to add to the todo list",
                },
            },
            "required": ["task"],
        },
    },
    {
        "type": "function",
        "name": "get_todo_list",
        "description": "Get the current todo list.",
        "parameters": {"type": "object", "properties": {}},
    },
    {
        "type": "function",
        "name": "get_todo_list_size",
        "description": "Get the number of items currently in the todo list.",
        "parameters": {"type": "object", "properties": {}},
    },
]

# ============================================
# AGENT FUNCTION
# ============================================
@playgent.record  # This creates a trace for the entire agent execution
def infer(input_text: str, model: str = "gpt-4", tools_list: List = None):
    """Main agent function that processes user input and manages tools."""
    if tools_list is None:
        tools_list = tools

    messages = [{"role": "user", "content": input_text}]

    while True:
        response = client.chat.completions.create(
            model=model,
            messages=messages,
            tools=tools_list
        )

        # Handle tool calls
        if response.choices[0].message.tool_calls:
            messages.append(response.choices[0].message)

            for tool_call in response.choices[0].message.tool_calls:
                name = tool_call.function.name
                args = json.loads(tool_call.function.arguments)

                # Execute the appropriate tool
                if name == "add_to_todo_list":
                    result = add_to_todo_list(**args)
                elif name == "get_todo_list":
                    result = get_todo_list()
                elif name == "get_todo_list_size":
                    result = get_todo_list_size()
                else:
                    result = f"Unknown tool: {name}"

                messages.append({
                    "role": "tool",
                    "tool_call_id": tool_call.id,
                    "content": json.dumps({"result": result})
                })
        else:
            # No more tool calls, return final response
            break

    return {
        "final_output": response.choices[0].message.content,
        "todo_list": todo_list
    }

# ============================================
# RUN THE AGENT
# ============================================
if __name__ == "__main__":
    result = infer("Add 'buy milk' and 'walk the dog' to my todo list")
    print(result)
```

</Accordion>

## What Gets Tracked?

With this instrumentation, Playgent automatically tracks:

- **Main trace**: The entire `infer()` function execution (via `@playgent.record`)
- **LLM spans**: All calls to `client.chat.completions.create()` (via `wrap_openai()`)
- **Tool spans**: Each tool function execution (via `@playgent.record` on tool functions)

All of this data appears in your Playgent dashboard for automatic analysis and issue detection.

<Note>
  The `@playgent.record` decorator can be applied to any function you want to
  trace, not just the main agent function. This allows you to create a detailed
  span hierarchy.
</Note>
